---
title: '**Como construir mapas isópacos utilizando R**'
author: "Dr. Fernando J. Gomez"
date: "12 de Octubre de 2017"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Objetivo

El objetivo principal de este tutorial es construir, a partir de datos estratigráficos (que pueden provenir de columnas, pozos, perfilajes, etc), **mapas isópacos** o mapas similares (ej. porcentajes litológicos y facies) usando **R**. Para esto es necesario hacer la interpolación entre puntos irregularmente espaciados (pozos de coordenadas *x*-*y*, y de espesores *z*) usando algunas de las librerías que tiene **R** para tal fin. El ejemplo en este caso es el del **Trabajo Práctico 11**. Los datos de *x*-*y*-*z* (*x* e *y* son coordenadas en planta y *z* es el espesor sedimentario). Los archivos de donde se leeran los datos y que son datos con extensión *csv* (*comma separated values*) de **EXCEL** o **LIBRE OFFICE** (*Datos_mapa_isospaco-xyz.csv* y *Datos_mapa_porcentaje_caliza-xyz.csv*) deben estar guardados en el directorio de trabajo o *working directory* de **R**.
Para saber cual es el directorio de trabajo puede escribirse *getwd()*. Para definir otro *working directory* se usa *setwd()* por lo que puede escribirse, por ejemplo *setwd("C:/Documents and Settings/Data")*. Los gráficos resultantes se guardaran automáticamente en este directorio definido (y allí ademas deberia estar guardado el archivo *csv* con los datos a plotear).

#Procedimiento

##Instalar **R** y las librerias a utilizar

El programa **R** puede instalarse del siguiente link: https://cran.r-project.org/.
Para construir nuestro mapa, para interpolar y graficar usaremos dos paquetes o librerías de **R** (que deben ser instaladas en caso que no lo esten), estas librerías son **akima** y **fields**.

Para Instalar estas librerías se puede ir a *tools* y luego *install packages* y buscar las librerías de interes.

**Nota**: Las lineas que inician con el numeral (#) no son leídas por R.

##Luego debemos llamar las librerias para utilizarlas

```{r Fig1, echo=TRUE, fig.height=9, fig.width=6.5, fig.align = "center"}
library(akima);
library(fields);

#esta linea lee la Tabla de datos que previamente fue guardada con extension
#cvs, y genera un data.frame que aqui llamamos "mydata"
mydata = data.frame(read.csv("Datos_mapa_isospaco-xyz.csv"))

#podemos escribir mydata en caso de de que queramos ver el set de datos a usar
mydata

#extraemos los valores x, y, z de mydata y los asignamos a x, y, z.
x<-mydata$x
y<-mydata$y
z<-mydata$z


#interpolamos usando akima (elegimos spline que es el metodo de interpolacion
#al escribir "linear=FALSE")
# elegimos el rango de valores de "x"" e "y".
akima.spl <- with(mydata, interp(x,y,z, xo=seq(0,15, length=100),
                                       yo=seq(0,20, length=100),
                                linear=FALSE))
#Luego ploteamos usando "image" para generar el grafico de colore
#Usamos"contour" para plotear las lineas isopacas
#usamos "points" para plotear los puntos de ubicacion de pozos
image(akima.spl, main = "Mapa Isópaco")
contour(akima.spl, add=TRUE)
points(mydata, pch = 20, cex = 2, col = "blue")
```

## Lo mismo se puede hacerse en el caso de porcentajes de calizas

En este caso simplemente cambiamos el archivo de donde se leeran los datos para hacer el grafico (*Datos_mapa_porcentaje_caliza-xyz.csv*). Abajo va el script completo.

```{r Fig2, echo=TRUE, fig.height=9, fig.width=6.5, fig.align = "center"}
library(akima);
library(fields)
mydata = data.frame(read.csv("Datos_mapa_porcentaje_caliza-xyz.csv"))
mydata
x<-mydata$x
y<-mydata$y
z<-mydata$z

akima.spl <- with(mydata, interp(x,y,z, xo=seq(0,15, length=100),
                                       yo=seq(0,20, length=100),
                                linear=FALSE))
image(akima.spl, main = "Mapa porcentaje de calizas")
contour(akima.spl, add=TRUE)
points(mydata, pch = 20, cex = 2, col = "blue")
```

